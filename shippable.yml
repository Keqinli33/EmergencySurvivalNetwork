# Language setting
language: node_js

# Version number
node_js:
  - "4.5.0"

services:
  - mongodb

# Declare global variables to be used during your build.
env:
  global:
    - APP_NAME=esnsv7keqin
    - IS_SHIPPABLE=true
    - HEROKU_API_KEY=59ac4c33-d4a6-4ff6-813d-5c1fdb8ae514

before_install:
  - npm install
  - bower --allow-root install

before_script:
 - mkdir -p shippable/testresults
 - mkdir -p shippable/codecoverage

# Your build commands goes here
build:
  # Commands that should be executed during the build.
  ci:
    - which heroku || wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh
    - sudo npm install -g grunt-cli mocha grunt istanbul
    - sudo npm install expect.js -save
    - sudo npm install grunt supertest grunt-mocha-test expect.js --save-dev
  #  - npm install -g
  #  - npm install
#    - npm start
    - grunt test
    - ./node_modules/.bin/mocha -R xunit ./test > shippable/testresults/result.xml --ui tdd
#    - ./node_modules/.bin/istanbul cover grunt -- -u tdd
#    - ./node_modules/.bin/istanbul cobertura --dir shippable/codecoverage/


# Commands to run after a successfull build
after_success:
  - git remote -v | grep ^heroku || heroku git:remote --ssh-git --app $APP_NAME
  - git push -f heroku unittest:master

# Notifications for each build
notifications:
   email: false